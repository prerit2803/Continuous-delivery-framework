---
- hosts: localhost
  gather_facts: yes
  environment:
    AWS_ACCESS_KEY_ID: "{{ env_vars.AWS_ACCESS_KEY_ID }}"
    AWS_SECRET_ACCESS_KEY: "{{ env_vars.AWS_SECRET_ACCESS_KEY }}"
  roles:
    - provision

- hosts: nodes
  gather_facts: no
  tasks:
  - name: Install python 2
    raw: sudo test -e /usr/bin/python || (sudo apt-get install -y python-minimal)

- hosts: nodes
  gather_facts: yes
  roles: 
    - setup-nodes

- hosts: master    
  gather_facts: yes
  roles:
    - kube-init

- hosts: slaves
  gather_facts: yes
  roles:
    - join-slaves

- hosts: master    
  gather_facts: yes
  roles:
    - deploy