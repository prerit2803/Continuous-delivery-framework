- name: Install docker-compose
  become: yes
  get_url: 
    url: https://github.com/docker/compose/releases/download/1.21.0/docker-compose-Linux-x86_64
    dest: /usr/local/bin/docker-compose
    mode: "u=rx,o=rx,g=rx"

- name: Copy checkbox files
  become: yes
  synchronize:
    src: ../Infrastructure
    dest: /usr/src/
    recursive: yes

- name: Set permission
  become: yes
  file: 
    path: /usr/src/Infrastructure
    mode: "u=rwx,g=rwx,o=rwx"
    state: directory

- name: Create docker-compose.yml
  template: 
    src: ./docker-compose.yml
    dest: /usr/src/Infrastructure/docker-compose.yml

- name: Create checkbox docker image
  command: docker-compose up -d
  args:
    chdir: /usr/src/Infrastructure 

- name: Deploy checkbox image
  shell: sudo kubectl run checkbox --image=ankursaxena135/checkbox
